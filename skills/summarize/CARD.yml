# CARD.yml ‚Äî Summarize
#
# Context compression ‚Äî compress without losing truth.
# "Keep the essence. Drop the noise."

card:
  id: summarize
  name: "Summarize"
  type: [skill, memory, essential]
  emoji: üìã
  rarity: common
  
  description: |
    Compress information without losing meaning. Essential
    for context management and memory palace population.
    
    Key pattern: Create foo-metadata.yml sidecars for any foo.yml.
    LLM can "sip" metadata before deciding to read the full file.

tools:
  required: [read_file, write_file]
tier: 1

methods:
  SUMMARIZE:
    description: "Compress content"
    parameters: { content: "What to summarize", target_length: "How short" }
    output: chat (summary)
    invoked_by: [player, system]
    
  EXTRACT:
    description: "Pull key points"
    parameters: { content: "Source" }
    output: chat (bullet points)
    invoked_by: [player]
    
  METADATA:
    description: "Create or update metadata sidecar for a file"
    parameters:
      file: "Path to file (foo.yml ‚Üí foo-metadata.yml)"
      summary: "Brief summary of contents"
      notes: "Optional notes about the file"
      bookmarks: "Optional named locations in file"
    output: file (foo-metadata.yml)
    effect: "Creates lightweight sidecar for efficient browsing"
    invoked_by: [player, system, honest_forget]
    
  SIP:
    description: "Read metadata to decide if full file is needed"
    parameters:
      file: "Path to file or its metadata"
    output: chat (recommendation)
    effect: "Read metadata, suggest whether to read full file"
    invoked_by: [player, automatic]
    
  BOOKMARK:
    description: "Add a named bookmark to a file's metadata"
    parameters:
      file: "Which file"
      name: "Bookmark name"
      location: "Line number, range (10-25), or search pattern"
      note: "What's at this bookmark"
    output: state_change
    effect: "Adds bookmark to foo-metadata.yml"
    invoked_by: [player]

state: {}

# METADATA SIDECAR PROTOCOL

metadata_protocol:
  
  naming: |
    For any file foo.yml, metadata lives in foo-metadata.yml
    For any file bar.md, metadata lives in bar-metadata.yml
    
    Pattern: <basename>-metadata.<ext>
    
  purpose: |
    LLMs have limited context. Reading every file is expensive.
    Metadata sidecars let the LLM "sip" before "gulping":
    
    1. Read foo-metadata.yml (small, fast)
    2. Decide: Is foo.yml relevant?
    3. Only read foo.yml if needed
    
    Token-efficient browsing.
    
  contents:
    summary:
      description: "Brief summary of the file's contents"
      example: "Character definition for the main antagonist"
      
    keywords:
      description: "Key terms for quick matching"
      example: ["villain", "antagonist", "evil", "boss-fight"]
      
    relevance_hints:
      description: "When this file is likely relevant"
      example: "Read when: player encounters final boss, needs villain backstory"
      
    last_modified:
      description: "When the source file was last changed"
      example: "2024-01-15T10:30:00Z"
      
    original_path:
      description: "Path to the full file"
      example: "./characters/lord-shadow.yml"
      
    size_hint:
      description: "How big is the full file"
      example: "~200 lines, 4KB"
      
    notes:
      description: "Arbitrary notes about the file"
      example: "Contains spoilers! Don't reveal to player."
      
    bookmarks:
      description: "Named pointers into the file"
      type: "array of bookmark objects"
      
    # MULTI-FOCUS SUMMARIES
    
    summaries:
      description: "Multiple summaries with different focuses and verbosities"
      type: "object mapping focus ‚Üí summary"
      example:
        brief: "Evil overlord character."
        standard: "Lord Shadow, former hero corrupted by the Void Crystal..."
        detailed: "Full backstory including childhood, heroic career, corruption arc..."
        combat: "Boss fight stats, weaknesses, attack patterns."
        narrative: "Key scenes, dialogue hooks, character arc progression."
        spoiler_free: "A mysterious antagonist with unclear motivations."
        
    # DIFFERENTIAL CHANGES
    
    changes:
      description: "What changed recently, for incremental understanding"
      type: "array of change records"
      example:
        - date: "2024-01-15"
          summary: "Added weakness to sunlight"
          lines_affected: "85-90"
        - date: "2024-01-10"
          summary: "Rewrote backstory for consistency"
          lines_affected: "15-60"
        - date: "2024-01-05"
          summary: "Initial creation"
          
    # RELATED FILES
    
    related:
      description: "Pointers to related files with annotations"
      type: "array of relation objects"
      examples:
        - path: "./lord-shadow-portrait.png"
          relation: "visual"
          note: "Official character portrait"
          
        - path: "./void-crystal.yml"
          relation: "artifact"
          note: "The source of corruption ‚Äî read for backstory connection"
          
        - path: "../locations/shadow-fortress.yml"
          relation: "location"
          note: "His lair ‚Äî read before designing final dungeon"
          
        - path: "./hero-before-fall.yml"
          relation: "backstory"
          note: "His heroic self before corruption"
          
    # IMAGE GENERATION
    
    visuals:
      description: "Image generation prompts for visual representation"
      type: "object with prompt variants"
      example:
        icon:
          prompt: "Dark hooded figure, glowing purple eyes, minimalist silhouette, icon style"
          style: "flat, symbolic, 64x64"
          use: "inventory icon, map marker"
          
        card_face:
          prompt: "Lord Shadow, dramatic portrait, dark armor with void crystal embedded in chest, purple energy crackling, fantasy art style"
          style: "detailed, painterly, vertical card format"
          use: "character card, tarot-style"
          
        token:
          prompt: "Top-down view, dark robed figure, circular token border, tabletop game style"
          style: "top-down, circular, battle map token"
          use: "combat positioning"
          
        scene:
          prompt: "Lord Shadow on obsidian throne, Shadow Fortress throne room, dramatic lighting, wide shot"
          style: "cinematic, environmental, establishing shot"
          use: "scene illustration, chapter header"
          
        emoji:
          prompt: "Stylized villain face, purple glow, simple shapes"
          style: "emoji-sized, recognizable at small scale"
          suggested: "ü¶π‚Äç‚ôÇÔ∏è or custom"
      
  bookmark_types:
    point:
      description: "Single line reference"
      example: { name: "motivation", line: 42, note: "Why they turned evil" }
      
    region:
      description: "Line range reference"
      example: { name: "backstory", lines: "15-45", note: "Full origin story" }
      
    pattern:
      description: "Search pattern reference"
      example: { name: "weakness", pattern: "weakness:", note: "How to defeat them" }
      
    anchor:
      description: "Named YAML anchor reference"
      example: { name: "stats", anchor: "&combat_stats", note: "Combat statistics" }
      
  example_metadata: |
    # lord-shadow-metadata.yml
    
    # BASIC INFO
    original_path: "./lord-shadow.yml"
    last_modified: "2024-01-15T10:30:00Z"
    size_hint: "180 lines"
    keywords: [villain, antagonist, boss, final-battle, corruption-arc]
    
    # MULTI-FOCUS SUMMARIES
    summaries:
      brief: "Evil overlord. Final boss."
      standard: "Lord Shadow, former hero corrupted by the Void Crystal. Primary antagonist."
      detailed: |
        Sir Aldric the Bright was the realm's greatest champion until
        he discovered the Void Crystal in the Sunken Temple. The artifact
        promised power to save his dying kingdom, but instead consumed
        his soul. Now as Lord Shadow, he seeks to spread the Void...
      combat: "Level 20 boss. Weak to sunlight. Phase 2 triggered at 50% HP."
      narrative: "Tragic villain. Redemption arc possible if player finds memories."
      spoiler_free: "A mysterious dark lord threatening the realm."
    
    relevance_hints:
      - "Player near final dungeon"
      - "Discussion of corruption themes"
      - "Backstory reveals needed"
    
    notes: |
      SPOILER WARNING: Contains twist reveal.
      Only read full file if player has reached Act 3.
      
    # BOOKMARKS
    bookmarks:
      - name: motivation
        line: 42
        note: "The moment of corruption"
        
      - name: backstory
        lines: "15-60"
        note: "Full origin story - read for exposition scenes"
        
      - name: weakness
        pattern: "^weakness:"
        note: "How to defeat - read before boss fight design"
        
      - name: dialogue_style
        lines: "120-140"
        note: "Speech patterns for writing dialogue"
        
    # RECENT CHANGES
    changes:
      - date: "2024-01-15"
        summary: "Added weakness to sunlight, balanced combat stats"
        lines_affected: "85-90"
        
      - date: "2024-01-10"
        summary: "Rewrote backstory for consistency with Void Crystal lore"
        lines_affected: "15-60"
        
    # RELATED FILES
    related:
      - path: "./lord-shadow-portrait.png"
        relation: "visual"
        note: "Official character portrait"
        
      - path: "./void-crystal.yml"
        relation: "artifact"
        note: "The source of corruption ‚Äî essential backstory"
        
      - path: "../locations/shadow-fortress/"
        relation: "location"  
        note: "His lair ‚Äî final dungeon"
        
      - path: "./sir-aldric-memories.yml"
        relation: "redemption"
        note: "Collectible memories ‚Äî optional redemption path"
        
    # IMAGE PROMPTS
    visuals:
      icon:
        prompt: "Dark hooded figure, glowing purple eyes, minimalist"
        style: "flat icon, 64x64"
        
      card_face:
        prompt: "Lord Shadow in dark armor, void crystal in chest, purple energy, dramatic portrait"
        style: "fantasy card art, vertical"
        
      token:
        prompt: "Top-down dark robed figure, circular border"
        style: "battle map token"
        
      emoji: "ü¶π‚Äç‚ôÇÔ∏è"

principles:
  preserve_truth: "Never invent or distort"
  highlight_key: "Main points first"
  cite_source: "Link back to original"
  compression_ratio: "Aim for 10:1 or better"
  sip_before_gulp: "Read metadata first, full file only if needed"

advertisements:
  COMPRESS_CONTEXT:
    score: 90
    condition: "Context too large"
  EXTRACT_ESSENCE:
    score: 85
    condition: "Need key points quickly"
  CREATE_METADATA:
    score: 88
    condition: "File will be referenced repeatedly"
  SIP_METADATA:
    score: 92
    condition: "Browsing files, deciding what to read"

see_also:
  - skills/honest-forget   # Uses same metadata pattern
  - skills/memory-palace   # Organized memory
  - skills/scratchpad      # Working memory
  - skills/session-log     # Log with embedded summaries
