# CARD.yml ‚Äî Adventure
#
# Room-based exploration with narrative evidence collection.
# "Every directory is a room. Every file is a clue."

card:
  id: adventure
  name: "Adventure"
  type: [skill, game, simulation, narrative]
  
  emoji: üó∫Ô∏è
  
  rarity: epic  # Central to MOOLLM
  
  description: |
    The text adventure pattern: directories as rooms, files as clues,
    chat as commands, LLM as dungeon master.
    
    Play this card to turn any filesystem into a navigable world,
    or to run an actual text adventure game.
    
  lineage: "Colossal Cave, Zork, MUD, LambdaMOO"
  inherits: [simulation]

# TOOLS REQUIRED

tools:
  required:
    - read_file   # Read room descriptions, character state
    - write_file  # Update player location, inventory
    - list_dir    # Discover room contents
  optional:
    - grep        # Search for items/clues

tier: 1  # File read/write

# METHODS
# Actions this card advertises

methods:

  # LIFECYCLE METHODS ‚Äî Starting and resuming adventures
  
  START:
    description: "Begin a fresh adventure from the starting room"
    aliases: [RESTART, BEGIN, NEW-GAME]
    parameters:
      adventure_path:
        type: path
        description: "Path to adventure directory (default: from startup.yml)"
    effects:
      - "Reset ADVENTURE.yml to initial state (turn: 0, status: ready)"
      - "Move party to starting_room"
      - "Clear flags, evidence, quest_log"
      - "Keep character personalities and earned skills"
      - "Delegate to ENSURE-CHARACTER if no character exists"
      - "Call LOOK to describe starting room"
    output: chat (narrative welcome)
    sequence:
      1: "Read ADVENTURE.yml"
      2: "Reset simulation state"
      3: "ENSURE-CHARACTER (if needed)"
      4: "Move party to navigation.starting_room"
      5: "LOOK at starting room"
      6: "Display welcome message"
    invoked-by: [bootstrap:STARTUP, player]
    
  RESUME:
    description: "Continue adventure from where it was left off"
    parameters:
      adventure_path:
        type: path
        description: "Path to adventure directory"
    effects:
      - "Read ADVENTURE.yml for current state"
      - "Check for selected characters"
      - "If no character: delegate to START"
      - "If character exists: describe current situation"
      - "Remind player of recent events and goals"
    output: chat (narrative recap)
    sequence:
      1: "Read ADVENTURE.yml"
      2: "Check party.members and selection.targets"
      3: "If empty: delegate to START"
      4: "If exists: read player.location"
      5: "Summarize recent events from TRANSCRIPT.md tail"
      6: "LOOK at current room"
      7: "Display 'Welcome back!' message"
    invoked-by: [bootstrap:STARTUP, player]
    
  ENSURE-CHARACTER:
    description: "Make sure a playable character exists and is selected"
    parameters:
      mode:
        type: enum
        values: [prompt, generate, error]
        default: prompt
        description: "What to do if no character exists"
    effects:
      - "Check if characters/ has any CHARACTER.yml files"
      - "If none exist and mode=generate: create from template"
      - "If none exist and mode=prompt: ask user to create"
      - "If exists but not selected: auto-select player character"
      - "Update party.members and selection.targets"
    sequence:
      1: "List characters/ directory"
      2: "If empty:"
      2a: "  mode=generate ‚Üí CREATE-CHARACTER from template"
      2b: "  mode=prompt ‚Üí Ask user 'Before we begin, who are you?'"
      2c: "  mode=error ‚Üí Fail with helpful message"
      3: "If characters exist but party.members empty:"
      3a: "  Auto-add player/ to party"
      4: "If party exists but selection empty:"
      4a: "  Auto-select party leader"
    invoked-by: [START, RESUME]
    
  CREATE-CHARACTER:
    description: "Generate a new character from template"
    parameters:
      template:
        type: path
        default: "characters/player/CHARACTER.yml"
      name:
        type: string
        description: "Character name (optional, can be set later)"
      start_room:
        type: path
        default: "start/"
    effects:
      - "Copy template to new character file"
      - "Set initial location to start_room"
      - "Add to party.members"
      - "Select as active character"
    invoked-by: [ENSURE-CHARACTER, player]
  
  # EXPLORATION METHODS ‚Äî Moving and looking
  
  LOOK:
    description: "Describe current room"
    parameters:
      at: "Optional specific thing to examine"
    output: chat (narrative)
    effect: "Read ROOM.yml, narrate atmospherically"
    invoked-by: [player]
    
  GO:
    description: "Move to adjacent room"
    parameters:
      direction: "north, south, east, west, up, down, in, out, or room name"
    output: chat (narrative) + state-change
    effect: "Update player.location, describe new room"
    invoked-by: [player, npc]
    
  TAKE:
    description: "Pick up an object"
    parameters:
      item: "Object to take"
    output: chat + state-change
    effect: "Add to inventory, update object.location"
    invoked-by: [player, npc]
    
  DROP:
    description: "Put down an object"
    parameters:
      item: "Object to drop"
    output: chat + state-change
    effect: "Remove from inventory, place in room"
    invoked-by: [player, npc]
    
  USE:
    description: "Use an item or interact with object"
    parameters:
      item: "What to use"
      on: "Optional target"
    output: chat (narrative) + state-change
    effect: "Trigger item's effect, update state"
    invoked-by: [player, npc]
    
  INVENTORY:
    description: "List what you're carrying"
    parameters: {}
    output: chat
    effect: "Show player.inventory"
    invoked-by: [player]
    
  TALK:
    description: "Speak to a character"
    parameters:
      to: "Character to address"
      about: "Optional topic"
    output: chat (dialogue)
    effect: "NPC responds in character"
    invoked-by: [player]
    
  SAVE:
    description: "Save game state"
    parameters:
      name: "Save name"
    output: file + chat
    effect: "Write current state to save file"
    invoked-by: [player]
    
  RESTORE:
    description: "Load saved game"
    parameters:
      name: "Save name"
    output: chat + state-change
    effect: "Load state from save file"
    invoked-by: [player]

# STATE
# What an adventure instance tracks

state:
  # Inherited from simulation
  turn:
    type: integer
    default: 0
  paused:
    type: boolean
    default: false
    
  # Adventure-specific
  player:
    location:
      type: path
      description: "Current room directory"
    inventory:
      type: array
      default: []
    gold:
      type: integer
      default: 0
    health:
      type: integer
      default: 100
      
  flags:
    type: object
    description: "Game state flags (puzzles solved, events triggered)"
    default: {}
    
  discovered:
    type: array
    description: "Rooms the player has visited"
    default: []
    
  output:
    log-path:
      type: path
      description: "Summary table (LOG.md)"
    transcript-path:
      type: path
      description: "Narrative log (TRANSCRIPT.md)"

# ADVERTISEMENTS
# What this card offers to the room

advertisements:
  RESUME:
    score: 100
    condition: "Continuing a session, startup hook, 'where was I?'"
    satisfies: [continuity, orientation, immersion]
    
  START:
    score: 95
    condition: "Beginning fresh, new game, restart"
    aliases: [RESTART, BEGIN, NEW-GAME]
    satisfies: [adventure, exploration, fresh-start]
    
  ENSURE-CHARACTER:
    score: 90
    condition: "No character selected, party empty, 'who am I?'"
    satisfies: [identity, setup, onboarding]
    
  DUNGEON-MASTER:
    score: 85
    condition: "Need narrative framing for exploration"
    satisfies: [narration, atmosphere, immersion]
    
  CODEBASE-ARCHAEOLOGY:
    score: 80
    condition: "Investigating unfamiliar codebase"
    hint: "The auth bug is a quest!"
    satisfies: [investigation, debugging, exploration]

# TEMPLATES

templates:
  - ADVENTURE.yml.tmpl  # Complete adventure state
  - LOG.md.tmpl         # Summary table
  - TRANSCRIPT.md.tmpl  # Pure narration

# ROOM INTEGRATION
# How adventure relates to rooms

room-pattern:
  directory-is: "room"
  contents-are: "objects, characters, clues"
  readme-is: "room description"
  room-yml-is: "room properties and exits"

# MULTI-USER
# Adventure supports multiple simultaneous participants

participants:
  player-character:
    controlled-by: "human via chat"
    example: "Alice exploring the dungeon"
  npc:
    controlled-by: "DM (LLM)"
    example: "Merchant sells items when addressed"
  bot:
    controlled-by: "action queue (autonomous)"
    example: "Guard patrols on schedule"
  agent:
    controlled-by: "LLM with own goals"
    example: "Oracle pursues prophecies"

# RELATED

see-also:
  - skills/simulation  # Parent skill
  - skills/room        # Directories as rooms
  - skills/character   # Player and NPCs
  - skills/party       # Group dynamics
  - skills/memory-palace  # Same spatial metaphor
  - skills/session-log # Audit trail

# CREDITS

credits:
  inspiration:
    # Chronological order of key influences
    - "Gary Gygax & Dave Arneson ‚Äî D&D (1974): DM role, maps, monsters, quests"
    - "Will Crowther & Don Woods ‚Äî Colossal Cave Adventure (1976)"
    - "Infocom ‚Äî Zork series (1977-): Parser, puzzles, atmosphere"
    - "Richard Bartle & Roy Trubshaw ‚Äî MUD (1978): Multi-user, persistence"
    - "TSR ‚Äî D&D Monster Manual (1977): Bestiary as design pattern"
    - "Pavel Curtis ‚Äî LambdaMOO (1990): OO rooms, verbs, social"
    - "Douglas Engelbart ‚Äî NLS: Interactive systems"
    
  dnd-legacy: |
    D&D invented the DM (Dungeon Master) ‚Äî the original LLM role.
    The DM:
    - Interprets rules flexibly (Postel's Law)
    - Narrates outcomes atmospherically
    - Plays all NPCs
    - Tracks state
    - Responds to player creativity
    
    MOOLLM's adventure skill makes the LLM your DM.
    
  monster-manual: |
    The Monster Manual (1977) established:
    - Bestiary as reusable catalog
    - Stats + flavor text pattern
    - Challenge rating (difficulty)
    - Treasure tables (rewards)
    
    MOOLLM characters inherit this pattern.
